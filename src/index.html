<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.4.1/lib/p5.min.js"></script>
    <script src="/p5.wasm.js"></script>
    <script>
        var bench = function (method, iterations, args, context) {

            var time = 0;
            var timer = function (action) {
                var d = Date.now();
                if (time < 1 || action === 'start') {
                    time = d;
                    return 0;
                } else if (action === 'stop') {
                    var t = d - time;
                    time = 0;
                    return t;
                } else {
                    return d - time;
                }
            };

            var result = [];
            var i = 0;
            timer('start');
            while (i < iterations) {
                result.push(method.apply(context, args));
                i++;
            }

            var execTime = timer('stop');

            if (typeof console === "object") {
                console.log("Mean execution time was: ", execTime / iterations);
                console.log("Sum execution time was: ", execTime);
                console.log("Result of the method call was:", result[0]);
            }

            return execTime;
        };
        // console.log(window.wasmReady);
        window.wasmReady.then(() => {
            alert(
                bench(window.oldFunc, 100000, [100,100], globalThis) + '\n' +
                bench(window.oldFunc, 100000, [100,100], globalThis) + '\n' +
                bench(p5.prototype.noise, 100000, [100,100], globalThis) + '\n' +
                bench(p5.prototype.noise, 100000, [100,100], globalThis)
            )
        }).catch((e) => {
            console.log('error ===> ', e);
        })
    </script>
</body>

</html>